- content_for :title, "rebate forms"

%h2
  Rebate forms
  - unless @council.nil?
    for #{@council.name}


.pure-g
  .search-form.pure-u-1
    = form_tag(admin_rebate_forms_path, method: :get, class: 'pure-form') do
      = text_field_tag :location, @location, placeholder: "Address"
      %button.pure-button
        = fa_icon 'search'

%p= paginate @rebate_forms

%table.pure-table.pure-table-bordered
  %thead
    %tr
      %th YEAR (ending)
      %th Council
      %th Valuation Id
      %th Applicant
      %th Address
      %th When
      %th Signed
      %th Witnessed

  %tbody
    - @rebate_forms.each do |rebate_form|
      %tr{ class: rebate_form.completed ? 'pure-table-odd' : '' }
        %td= rebate_form.property.rating_year
        %td
          - if rebate_form.council.present?
            = link_to rebate_form.council.name, admin_council_path(rebate_form.council)
        %td= rebate_form.valuation_id
        %td= rebate_form.fields['full_name']
        %td
          - if rebate_form.property.present?
            %p
              = rebate_form.property.location
              %br/
              = rebate_form.property.suburb
              %br/
              = rebate_form.property.town_city
        %td= rebate_form.created_at.localtime
        %td
          - if rebate_form.applicant_signature.present?
            = link_to admin_rebate_form_path(rebate_form, format: 'pdf'), class: 'pure-button' do
              = fa_icon 'download'
          - else
            = render 'sign_button', rebate_form: rebate_form, class: 'pure-button pure-button-primary'
        %td= render 'witness', signature: rebate_form.witness_signature
        %td
          = link_to admin_rebate_form_path(rebate_form), class: 'pure-button' do
            show
        %td
          - if policy(rebate_form).destroy?
            = link_to admin_rebate_form_path(rebate_form), method: :delete,
              data: { confirm: 'Are you sure?' }, class: 'pure-button' do
              = fa_icon 'trash'

%p= paginate @rebate_forms
