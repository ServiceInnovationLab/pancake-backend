(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(e,t,a){e.exports=a.p+"static/media/tick.12268824.svg"},12:function(e,t,a){e.exports=a(22)},18:function(e,t,a){},22:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),s=a(9),c=a.n(s),i=(a(18),a(3)),l=a(2),o=a.n(l),u=a(5),m=a(1),p=(a(7),{started:!1,pending:!1,error:null,start:null,result:null}),d=function(e,t){switch(t.type){case"init":return p;case"ready":return Object(m.a)({},e,{start:t.start});case"start":return Object(m.a)({},e,{started:!0,pending:!0,error:!1});case"result":return Object(m.a)({},e,{pending:!1,result:t.result});case"error":return Object(m.a)({},e,{pending:!1,error:t.error});default:throw new Error("Unhandled action type: ".concat(t.type))}},g=function(e,t){var a=Object(n.useReducer)(d,p),r=Object(i.a)(a,2),s=r[0],c=r[1];return Object(n.useEffect)(function(){var a=!0,n=function(){var n=Object(u.a)(o.a.mark(function n(){var r;return o.a.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!t[0]){n.next=7;break}return c({type:"start"}),n.next=5,e();case 5:r=n.sent,a&&c({type:"result",result:r});case 7:n.next=12;break;case 9:n.prev=9,n.t0=n.catch(0),c({type:"error",error:n.t0});case 12:case"end":return n.stop()}},n,null,[[0,9]])}));return function(){return n.apply(this,arguments)}}();return t[0]&&c({type:"ready",start:n}),function(){c({type:"init"}),a=!1}},t),s},E=function(e,t){var a=e&&e.start,r=e&&e.result;Object(n.useEffect)(function(){return a&&a(),function(){}},[a]),Object(n.useEffect)(function(){r&&t(r)},[r])};function N(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"$",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:",";if("undefined"===typeof e)return"$0.00";try{a=Math.abs(a),a=isNaN(a)?2:a;var s=e<0?"-":"",c=parseInt(e=Math.abs(Number(e)||0).toFixed(a)).toString(),i=c.length>3?c.length%3:0,l=a?n+Math.abs(e-c).toFixed(a).slice(2):"";return e-c===0&&(l=""),t+s+(i?c.substr(0,i)+r:"")+c.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+r)+l}catch(o){return e}}var f=function(e){var t=(new Date).getFullYear()-1,a=(new Date).getFullYear()-2+"/"+((new Date).getFullYear()-1),n=e.extraClassNextButton,s=e.application,c=s.full_name,i=s.occupation,l=s.address,o=s.ratesBill,u=s.noOfDependants,m=s.spouse_or_partner,p=s.total_income,d=s.lived_in_property_1_July,g=s.moved_within_rating_year,E=s.income_less_than_5k,f=N(p),y=N(o);return r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"controlsBackground"},r.a.createElement("div",{className:"controls"},r.a.createElement("button",{className:"next "+n,onClick:e.onNext},"NEXT"))),r.a.createElement("div",{className:"text-content"},r.a.createElement("h1",null,"Application summary"),r.a.createElement("p",{className:"summary"},"Please check these details for your rebate claim."),r.a.createElement("p",null,"My name is ",r.a.createElement("strong",null,c)," and my occupation is ",r.a.createElement("strong",null,i),"."),r.a.createElement("p",null,"My address is ",r.a.createElement("strong",null,l)," and",d?" I lived here on":" I have not lived here","  1 July ",t,".",g?" I have moved ":" I have not moved"," within this rating year."),r.a.createElement("p",null,"My ",t," rates bill (including water) is ",r.a.createElement("strong",null,y),"."),r.a.createElement("p",null,"I have ",r.a.createElement("strong",null,u)," dependants."),m?r.a.createElement("p",null,"Our combined income (before tax) for the ",a," tax year is ",r.a.createElement("strong",null,f),"."):r.a.createElement("p",null,"My income (before tax) for the ",a," tax year is ",r.a.createElement("strong",null,f),"."),E&&r.a.createElement("p",null,"I supported myself on less than $5,000 by ",E)))},y=a(11),v=function(e){var t=Object(n.useState)(!1),a=Object(i.a)(t,2),s=a[0],c=a[1],l=Object(n.useState)(null),o=Object(i.a)(l,2),u=o[0],m=o[1],p=e.extraClassBackButton,d=e.extraClassNextButton;function g(){c(!1),document.getElementsByClassName("sigBgImage")[0].style.cssText="visibility: hidden; opacity: 0;transition: visibility 0s .35s, opacity .35s linear;",document.querySelector(".signature").className="signature"}return Object(n.useEffect)(function(){u&&(u.onBegin=g)},[u]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",{className:"controlsBackground"},r.a.createElement("div",{className:"controls"},r.a.createElement("button",{className:"back "+p,name:"sign",onClick:e.back},"GO BACK"),r.a.createElement("button",{className:"next "+d,name:"sign",onClick:function(){u.isEmpty()?(c(!0),document.querySelector(".signature").className="signature error"):(c(!1),e.next({signature:u.toDataURL()}))}},e.nextButtonLabel))),r.a.createElement("div",{className:"text-content"},r.a.createElement("h1",null,e.title),r.a.createElement("p",{className:"summary"},e.subheading),r.a.createElement("div",{className:"signature"},r.a.createElement("div",{className:"wrap-signature-canvas"},s&&r.a.createElement("p",{className:"signature__error-msg ga-error-sigwrite"},r.a.createElement("span",null,"Please sign before you proceed")),r.a.createElement("span",{className:"sigBgImage"}),r.a.createElement(y.a,{ref:function(e){return m(e)},penColor:"#369",canvasProps:{className:"sigCanvas"},redrawOnResize:!0})),"applicant"===e.declaration&&r.a.createElement(h,{data:e.application}),"witness"===e.declaration&&r.a.createElement(b,{data:e.witness}))))},h=function(e){return r.a.createElement("p",{className:"signatureSection"},"I, ",r.a.createElement("strong",null,e.data.full_name)," of ",r.a.createElement("strong",null,e.data.address),", occupation ",r.a.createElement("strong",null,e.data.occupation),", solemnly and sincerely declare that I believe the information I have given on this form is true and correct, and I make this solemn declaration conscientiously believing the same to be true and by virtue of the Oaths and Declarations Act 1957.")},b=function(e){var t=(new Date).toLocaleDateString("en-NZ",{weekday:"long",year:"numeric",month:"long",day:"numeric"});return r.a.createElement("p",{className:"signatureSection"},"Declared at ",r.a.createElement("strong",null,e.data.location)," this\xa0",r.a.createElement("strong",null,t)," before me, ",r.a.createElement("strong",null,e.data.name),", ",r.a.createElement("strong",null,e.data.occupation),".")},_=(a(8),function(e){return r.a.createElement("div",{className:"wrap-system-msg"},r.a.createElement("p",{className:"system-msg system-msg--processing"},e.message),r.a.createElement("div",{className:"sk-fading-circle"},r.a.createElement("div",{className:"sk-circle1 sk-circle"}),r.a.createElement("div",{className:"sk-circle2 sk-circle"}),r.a.createElement("div",{className:"sk-circle3 sk-circle"}),r.a.createElement("div",{className:"sk-circle4 sk-circle"}),r.a.createElement("div",{className:"sk-circle5 sk-circle"}),r.a.createElement("div",{className:"sk-circle6 sk-circle"}),r.a.createElement("div",{className:"sk-circle7 sk-circle"}),r.a.createElement("div",{className:"sk-circle8 sk-circle"}),r.a.createElement("div",{className:"sk-circle9 sk-circle"}),r.a.createElement("div",{className:"sk-circle10 sk-circle"}),r.a.createElement("div",{className:"sk-circle11 sk-circle"}),r.a.createElement("div",{className:"sk-circle12 sk-circle"})))}),I=function(e){var t=e.task,a=e.title,n=e.errorTitle,s=e.extraClassNextButton,c=t.error&&function(e,t){return console.log(e,"ERRROR"),"409"===e.message?"This application has been updated. Please regenerate the QR code to sign the application.":"422"===e.message?"This application has already been signed.":t}(t.error,n);return r.a.createElement(r.a.Fragment,null,t.pending&&r.a.createElement(_,{message:a}),t.error&&r.a.createElement("div",{className:"wrap-system-msg"},r.a.createElement("p",{className:"system-msg system-msg--error"},c),r.a.createElement("button",{className:"next "+s,onClick:function(){return t.start()}},"Try Again")))};var k=function(e,t){switch(t.type){case"RECEIVED_TOKEN":return Object(m.a)({},e,{token:t.data.token,witness:t.data.witness,currentScreen:"FETCH-APPLICATION"});case"FETCHED_APPLICATION":return Object(m.a)({},e,{currentScreen:"CONFIRM-APPLICATION",application:t.application});case"CONFIRMED_APPLICATION":return Object(m.a)({},e,{currentScreen:"SIGN-APPLICANT"});case"APPLICANT_SIGNED":return Object(m.a)({},e,{currentScreen:"SIGN-WITNESS",signatureApplicant:t.signature,signatureWitness:""});case"CANCEL_APPLICANT_SIGN":return Object(m.a)({},e,{currentScreen:"CONFIRM-APPLICATION",signatureApplicant:"",signatureWitness:""});case"WITNESS_SIGNED":return Object(m.a)({},e,{currentScreen:"SUBMITTING-APPLICATION",signatureWitness:t.signature,readyToSubmit:!0});case"CANCEL_WITNESS_SIGN":return Object(m.a)({},e,{currentScreen:"SIGN-APPLICANT",signatureApplicant:"",signatureWitness:""});case"APPLICATION_SUBMITTED":return Object(m.a)({},e,{currentScreen:"THANK-YOU"});default:throw new Error("Unhandled action type "+t.type)}},S=function(e,t,a){var n=g(Object(u.a)(o.a.mark(function t(){var a,n,r,s,c,i;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,fetch("/api/v1/rebate_forms/?jwt=".concat(e)).then(function(e){if(e.status>=200&&e.status<300)return e;console.log(e,"RESPONSE");var t=new Error(e.status);throw t.response=e.json(),t});case 2:return a=t.sent,t.next=5,a.json();case 5:return n=t.sent,r=n.data.attributes,s=r.total_rates,c=r.location,i=r.fields,t.abrupt("return",{full_name:i.full_name,occupation:i.occupation,address:c,ratesBill:s,noOfDependants:i.dependants,spouse_or_partner:"undefined"!==typeof i.spouse_or_partner&&"yes"===i.spouse_or_partner,total_income:i.income.total_income,income_less_than_5k:i.income_less_than_5k,moved_within_rating_year:"undefined"!==typeof i.moved_within_rating_year&&"yes"===i.moved_within_rating_year,lived_in_property_1_July:"undefined"!==typeof i.lived_in_property_1_July&&"yes"===i.lived_in_property_1_July});case 8:case"end":return t.stop()}},t)})),a);return E(n,t),n},w=function(e,t,a){var n=g(Object(u.a)(o.a.mark(function t(){var a,n,r,s,c,i,l;return o.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a=e.token,n=e.signatureApplicant,r=e.signatureWitness,s=e.application,c=e.witness,i={data:{token:"".concat(a),signatures:[{image:n,name:s.full_name,role:s.occupation,type:"applicant"},{image:r,name:c.name,role:c.occupation,type:"witness"}]}},t.next=4,fetch("/api/v1/signatures",{method:"POST",mode:"cors",cache:"no-cache",credentials:"omit",headers:{"Content-Type":"application/json"},redirect:"follow",referrer:"no-referrer",body:JSON.stringify(i)}).then(function(e){if(e.status>=200&&e.status<300)return e;var t=new Error(e.status);throw t.response=e.json(),t});case 4:return l=t.sent,t.next=7,l.json();case 7:return t.abrupt("return",t.sent);case 8:case"end":return t.stop()}},t)})),a);return E(n,t),n},O=a(10),C=a.n(O);var x=function(){var e=Object(n.useReducer)(k,{}),t=Object(i.a)(e,2),a=t[0],s=t[1];Object(n.useEffect)(function(){var e=new URLSearchParams(window.location.search).get("t");try{var t=function(e){var t=e.split(".")[1],a=decodeURIComponent(atob(t).split("").map(function(e){return"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(a)}(e);s({type:"RECEIVED_TOKEN",data:{token:e,witness:t.witness}})}catch(a){console.log(a)}},[]);var c=S(a.token,function(e){s({type:"FETCHED_APPLICATION",application:e})},[a.token]),l=w(a,function(){s({type:"APPLICATION_SUBMITTED"})},[a.readyToSubmit]);return r.a.createElement("div",{className:"App"},r.a.createElement("header",null,r.a.createElement("h2",null,"Rates Rebate 2018/2019")),r.a.createElement("div",{className:"content"},r.a.createElement(I,{task:c,title:"Retrieving application...",errorTitle:"Error while retrieving application",extraClassNextButton:"ga-error-appget"}),r.a.createElement(I,{task:l,title:"Submitting application...",errorTitle:"Error while submitting application",extraClassNextButton:"ga-error-sigsend"}),"CONFIRM-APPLICATION"===a.currentScreen&&r.a.createElement(f,{application:a.application,onNext:function(){return s({type:"CONFIRMED_APPLICATION"})},extraClassNextButton:"ga-appsum-next"}),"SIGN-APPLICANT"===a.currentScreen&&r.a.createElement(v,{declaration:"applicant",nextButtonLabel:"NEXT",application:a.application,title:"Applicant signature",subheading:"Please sign to complete your application",next:function(e){return s({type:"APPLICANT_SIGNED",signature:e.signature})},back:function(){return s({type:"CANCEL_APPLICANT_SIGN"})},extraClassBackButton:"ga-appsig-goback",extraClassNextButton:"ga-appsig-next"}),"SIGN-WITNESS"===a.currentScreen&&r.a.createElement(v,{declaration:"witness",nextButtonLabel:"SUBMIT",application:a.application,witness:a.witness,title:"Witness signature",subheading:"Signature of person authorised to witness this declaration",next:function(e){return s({type:"WITNESS_SIGNED",signature:e.signature})},back:function(){return s({type:"CANCEL_WITNESS_SIGN"})},extraClassBackButton:"ga-witsig-goback",extraClassNextButton:"ga-witsig-submit"}),"THANK-YOU"===a.currentScreen&&r.a.createElement("div",{className:"endScreen ga-deccomplete"},r.a.createElement("h1",null,"Thank you"),r.a.createElement("p",{className:"summary"},"This declaration is now complete and ready to be processed."),r.a.createElement("img",{src:C.a,alt:"tick",className:"img-tick"}))))};c.a.render(r.a.createElement(x,null),document.getElementById("root"))},8:function(e,t,a){}},[[12,1,2]]]);
//# sourceMappingURL=main.ffc30063.chunk.js.map